<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω S·∫£n Ph·∫©m</title>
    
    <!-- Th√™m font t·ª´ Google Fonts (v√≠ d·ª•: Roboto) -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        .quanlysanpham {
            font-family: 'Roboto', sans-serif; /* ƒê·ªïi th√†nh font mong mu·ªën */
        }
    </style>
</head>
<style>
 /*@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');*/
 
body { 
    font-family: 'Poppins', Arial, sans-serif; 
    text-align: center; 
    margin: 0; 
    padding: 0;
    background: url("background_sp.jpg") ;
    background-size: cover;  /* Ph·ªß to√†n m√†n h√¨nh, kh√¥ng b·ªã m√©o */
    background-position: center; /* CƒÉn gi·ªØa ·∫£nh */
    background-repeat: no-repeat; /* Kh√¥ng l·∫∑p l·∫°i */
    background-attachment: fixed; /* Gi·ªØ c·ªë ƒë·ªãnh khi cu·ªôn trang */
}

h2 { 
    margin-top: 25px;
    color: #333; 
    font-size: 26px; 
    margin-bottom: 15px;
    font-weight: 600;
}
.clock {
    font-size: 24px;
    font-weight: bold;
    color: white;
    background: rgba(93, 97, 127, 0.7); /* C·∫£i thi·ªán m√†u n·ªÅn v·ªõi alpha */
    padding: 10px 20px;
    border-radius: 10px; /* ƒê∆∞·ªùng vi·ªÅn m·ªÅm m·∫°i h∆°n */
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px; /* Kho·∫£ng c√°ch gi·ªØa icon v√† th·ªùi gian */
    margin: 15px auto; /* CƒÉn gi·ªØa t·ª± ƒë·ªông tr√™n v√† d∆∞·ªõi */
    max-width: 400px; /* Gi·ªõi h·∫°n chi·ªÅu r·ªông t·ªëi ƒëa */
    width: 100%;
    box-sizing: border-box;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Th√™m b√≥ng cho khung ƒë·ªìng h·ªì */
}

.clock-icon {
    width: 60px;
    height: 60px;
    animation: spin 60s linear infinite; /* Xoay 1 v√≤ng trong 60 gi√¢y */
}

/* Th√™m hi·ªáu ·ª©ng quay cho bi·ªÉu t∆∞·ª£ng ƒë·ªìng h·ªì */
@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

table { 
    width: 90%; 
    margin: 20px auto; 
    border-collapse: collapse; 
    background: #fff; 
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); 
    border-radius: 10px; 
    overflow: hidden;
}

th, td { 
    border: 1px solid #dee2e6; 
    padding: 12px; 
    text-align: center;
}

th { 
    background: linear-gradient(135deg, #007bff, #0056b3); 
    color: white; 
    text-transform: uppercase;
    font-weight: 600;
}

td input { 
    width: 100px; 
    text-align: center; 
    border: 1px solid #ccc; 
    border-radius: 5px; 
    padding: 6px;
    transition: all 0.3s ease-in-out;
}

td input:focus { 
    border-color: #007bff; 
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5); 
    outline: none;
}

button { 
    padding: 10px 15px; 
    cursor: pointer; 
    border: none; 
    border-radius: 8px; 
    font-weight: bold; 
    transition: all 0.3s ease-in-out;
}

button.green { 
    background: #28a745; 
    color: white;
}

button.green:hover { 
    background: #218838;
}

button.red { 
    background: #dc3545; 
    color: white;
}

button.red:hover { 
    background: #c82333;
}

.status { 
    font-weight: bold; 
    margin-top: 10px; 
    padding: 10px; 
    display: inline-block; 
    border-radius: 5px;
}

.status.green { 
    color: green; 
}

.status.red { 
    color: red; 
}

button#backButton { 
    margin-top: 20px; 
    padding: 12px 25px; 
    font-size: 16px; 
    background: #ff5733; 
    color: white; 
    border: none; 
    cursor: pointer; 
    border-radius: 8px;
    transition: 0.3s;
}

button#backButton:hover { 
    background: #e04122; 
    transform: scale(1.05);
}
.battery {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 50px;
  height: 20px;
  border: 2px solid #333;
  border-radius: 3px;
  padding: 2px;
  background-color: #ecf9eb;
  position: relative;
}

.battery-segment {
  width: 8px;
  height: 100%;
  margin: 0 1px;
  background-color: #ccc;
  border-radius: 1px;
  transition: background-color 0.3s, opacity 0.3s;
}

.battery-segment.filled {
  background-color: green;
}

.battery-segment.low-blink {
  animation: blink-red 1s infinite;
}

@keyframes blink-red {
  0%, 100% {
    background-color: red;
    opacity: 1;
  }
  50% {
    background-color: red;
    opacity: 0.2;
  }
}
 /*can nang*/
/* Hi·ªáu ·ª©ng nh·∫•p nh√°y cho ph·∫ßn c√¢n n·∫∑ng d∆∞·ªõi 2kg */
.blink {
    animation: blinkAnimation 1s infinite;
}

@keyframes blinkAnimation {
    0% {
        color: red;
    }
    50% {
        color: transparent;
    }
    100% {
        color: red;
    }
}
/*√¥ id*/
.blink {
  animation: blink-red 1s infinite;
  color: white;
}

@keyframes blink-red {
  0% { background-color: red; }
  50% { background-color: transparent; }
  100% { background-color: red; }
}


/* Hi·ªáu ·ª©ng khi th√™m h√†ng */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

@media screen and (max-width: 768px) {
    table { width: 100%; }
    input { width: 80px; }
    button { font-size: 14px; padding: 6px 12px; }
}


</style>
<h2>QU·∫¢N L√ù S·∫¢N PH·∫®M</h2>
<div class="clock" id="clock">
    <img src="https://cdn4.iconfinder.com/data/icons/shopping-e-commerce-10/33/processing_time-128.png" alt="Clock Icon" class="clock-icon">
    <span id="time">00:00:00</span>
</div>
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>S·∫£n Ph·∫©m</th>
           <!-- <th> ƒê·ªãa ch·ªâ </th> -->
            <th>Gi√° (VNƒê)</th>
            <th>Gi·∫£m gi√° (%)</th>
            <th>Gi·ªù sale b·∫Øt ƒë·∫ßu</th> 
            <th>Gi·ªù sale k·∫øt th√∫c</th>
            
            <th>Tr·∫°ng Th√°i</th>
            <th>H√†nh ƒê·ªông</th>
            <th>Pin</th>
            <th>C√¢n n·∫∑ng</th>

        </tr>
    </thead>
    <tbody id="productTable">
        <tr>
            <td id="productId01">01</td>
            <td><input type="text" id="product1" value="Milk"></td>
            <!-- <td><input type="text" id="add1" value="A"></td> -->
            <td><input type="text" id="price1" value="20 000"></td>
            <td><input type="text" id="sale1" placeholder=""></td>
            <td><input type="time" id="saleStartTime1"onclick="toggleTime(this)"></td> 
            <td><input type="time" id="saleEndTime1"onclick="toggleTime(this)"></td>
            <td id="status1">Ch∆∞a c·∫≠p nh·∫≠t</td>
            <td><button onclick="sendPrice('01', 'product1', 'A', 'price1', 'sale1','saleStartTime1','saleEndTime1', 'status1')">C·∫≠p Nh·∫≠t</button></td>
            <td>
                <div class="battery" id="battery01">
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                </div>
              </td>
            <td><input type="text" id="weight01" disabled /></td>

        </tr>
        <tr>
            <td id="productId02">02</td>
            <td><input type="text" id="product2" value="Bread"></td>
            <!-- <td><input type="text" id="add2" value="B"></td>  -->
            <td><input type="text" id="price2" value="15 000"></td>
            <td><input type="text" id="sale2" placeholder=""></td>
            <td><input type="time" id="saleStartTime2"onclick="toggleTime(this)"></td> 
            <td><input type="time" id="saleEndTime2"onclick="toggleTime(this)"></td>
            <td id="status2">Ch∆∞a c·∫≠p nh·∫≠t</td>
            <td><button onclick="sendPrice('02', 'product2', 'B', 'price2', 'sale2','saleStartTime2','saleEndTime2', 'status2')">C·∫≠p Nh·∫≠t</button></td>
            <td>
                <div class="battery" id="battery02">
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                </div>
              </td>
            <td><input type="text" id="weight02" disabled /></td>

        </tr>
        <tr>
            <td id="productId03">03</td>
            <td><input type="text" id="product3" value="Pepsi"></td>
            <!-- <td><input type="text" id="add3" value="C"></td>  -->
            <td><input type="text" id="price3" value="10 000"></td>
            <td><input type="text" id="sale3" placeholder=""></td>
            <td><input type="time" id="saleStartTime3"onclick="toggleTime(this)"></td> 
            <td><input type="time" id="saleEndTime3"onclick="toggleTime(this)"></td>
            <td id="status3">Ch∆∞a c·∫≠p nh·∫≠t</td>
            <td><button onclick="sendPrice('03', 'product3', 'C', 'price3', 'sale3','saleStartTime3','saleEndTime3', 'status3')">C·∫≠p Nh·∫≠t</button></td>
            <td>
                <div class="battery" id="battery03">
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                </div>
              </td>
            <td><input type="text" id="weight03" disabled /></td>
        </tr>
        <tr>
            <td id="productId04">04</td>
            <td><input type="text" id="product4" value="Noodle"></td>
            <!-- <td><input type="text" id="add4" value="D"></td>  -->
            <td><input type="text" id="price4" value="4 500"></td>
            <td><input type="text" id="sale4" placeholder=""></td>
            <td><input type="time" id="saleStartTime4"onclick="toggleTime(this)"></td> 
            <td><input type="time" id="saleEndTime4"onclick="toggleTime(this)"></td>
            <td id="status4">Ch∆∞a c·∫≠p nh·∫≠t</td>
            <td><button onclick="sendPrice('04', 'product4', 'D', 'price4', 'sale4','saleStartTime4','saleEndTime4', 'status4')">C·∫≠p Nh·∫≠t</button></td>
            <td>
                <div class="battery" id="battery04">
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                </div>
              </td>
            <td><input type="text" id="weight04" disabled /></td>
        </tr>
        <tr>
            <td id="productId05">05</td>
            <td><input type="text" id="product5" value="Pork"></td>
            <!-- <td><input type="text" id="add5" value="D"></td>  -->
            <td><input type="text" id="price5" value="30 000"></td>
            <td><input type="text" id="sale5" placeholder=""></td>
            <td><input type="time" id="saleStartTime5"onclick="toggleTime(this)"></td> 
            <td><input type="time" id="saleEndTime5"onclick="toggleTime(this)"></td>
            <td id="status5">Ch∆∞a c·∫≠p nh·∫≠t</td>
            <td><button onclick="sendPrice('05', 'product5', 'D', 'price5', 'sale5','saleStartTime5','saleEndTime5', 'status5')">C·∫≠p Nh·∫≠t</button></td>
            <td>
                <div class="battery" id="battery05">
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                  <div class="battery-segment"></div>
                </div>
              </td>
            <td><input type="text" id="weight05" disabled /></td>
        </tr>
    </tbody>
</table>

<p class="status" id="wsStatus"></p> 
<button onclick="goBack()" style="margin-top: -70px; padding: 10px 20px; font-size: 16px; background: #dc3545; 
color: white; border: none; cursor: pointer;margin-left: 1155px">‚¨Ö Quay L·∫°i Trang Ch·ªß</button>

<script>
    const ws = new WebSocket('ws://localhost:8080');
    ws.onopen = () => {
    ws.send(JSON.stringify({ device: "browser" }));
    console.log("ƒê√£ k·∫øt n·ªëi WebSocket");

    const status = document.getElementById('wsStatus');
    if (status) {
        status.innerText = '‚úÖ ƒê√£ k·∫øt n·ªëi v·ªõi WebSocket';
        status.style.color = 'green';
    }
};

    ws.onclose = () => {
        document.getElementById('wsStatus').innerText = '‚ùå M·∫•t k·∫øt n·ªëi v·ªõi WebSocket';
        document.getElementById('wsStatus').style.color = 'red';
    };

    // Nh·∫≠n v√† x·ª≠ l√Ω d·ªØ li·ªáu t·ª´ ESP32
    ws.onmessage = (event) => {
    const data = JSON.parse(event.data);  // D·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c t·ª´ ESP32
    console.log("D·ªØ li·ªáu t·ª´ ESP32:", data);  // In d·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c
    updateProductInfo(data);  // Hi·ªÉn th·ªã d·ªØ li·ªáu l√™n giao di·ªán
};

    function checkSaleTime() {
        const now = new Date();
        const currentTime = now.toLocaleTimeString('vi-VN', { hour12: false });
        
        for (let i = 1; i <= 5; i++) {
            const saleTimeInput = document.getElementById(`saleTime${i}`).value;
            if (saleTimeInput && saleTimeInput === currentTime) {
                applySale(i);
            }
        }
    }
    function formatNumber(number) {
    return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
}
//pin
function updateBatteryDisplay(batteryId, batteryLevel) {
  const batteryDiv = document.getElementById(batteryId);
  if (!batteryDiv) return;

  const segments = batteryDiv.querySelectorAll(".battery-segment");
  segments.forEach(segment => {
    segment.classList.remove("filled", "low-blink");
    segment.style.backgroundColor = "#ccc";
  });

  if (batteryLevel < 20) {
    batteryDiv.classList.add("low");
    segments[0].classList.add("low-blink");
  } else {
    batteryDiv.classList.remove("low");
    const filledCount = Math.ceil(batteryLevel / 20);
    for (let i = 0; i < filledCount; i++) {
      segments[i].classList.add("filled");
      segments[i].style.backgroundColor = "green";
    }
  }
}

function updateProductInfo(data) {
  const productId = data.id;
  const weight = data.weight;
  const power = parseInt(data.power);

  const rows = document.querySelectorAll('table tr');

  rows.forEach((row) => {
    const td = row.querySelector('td');
    if (td && td.textContent.trim() === productId) {
      const weightInput = row.querySelector(`#weight${productId}`);
      const batteryDiv = row.querySelector(`#battery${productId}`);
      const statusElem = row.querySelector(`#status${productId}`);
      const productIdCell = document.getElementById(`productId${productId}`);

      let isLowBattery = power < 20;
      let isLowWeight = weight < 100;

      // C·∫≠p nh·∫≠t c√¢n n·∫∑ng v√† tr·∫°ng th√°i nh√°y
      if (weightInput) {
        weightInput.value = weight + "g";
        weightInput.classList.toggle("blink", isLowWeight);
      }

      // C·∫≠p nh·∫≠t tr·∫°ng th√°i pin
      if (batteryDiv) {
        updateBatteryDisplay(`battery${productId}`, power);
      }

      // C·∫≠p nh·∫≠t tr·∫°ng th√°i "C·∫≠p nh·∫≠t th√†nh c√¥ng"
      if (statusElem) {
        statusElem.innerText = "C·∫≠p nh·∫≠t th√†nh c√¥ng";
      }

      // C·∫≠p nh·∫≠t tr·∫°ng th√°i nh√°y √¥ ID
      if (productIdCell) {
        if (isLowBattery || isLowWeight) {
          productIdCell.classList.add("blink");
        } else {
          productIdCell.classList.remove("blink");
        }
      }

      // N·∫øu pin = 0, v√¥ hi·ªáu h√≥a t·∫•t c·∫£ √¥ nh·∫≠p li·ªáu tr·ª´ √¥ pin v√† c√¢n n·∫∑ng
      if (power === 0) {
        row.querySelectorAll('input').forEach(input => {
          if (input.id !== `weight${productId}` && input.id !== `battery${productId}`) {
            input.disabled = true; // V√¥ hi·ªáu h√≥a c√°c √¥ nh·∫≠p li·ªáu
          }
        });
        row.querySelector('button').disabled = true; // V√¥ hi·ªáu h√≥a n√∫t c·∫≠p nh·∫≠t
      } else {
        row.querySelectorAll('input').forEach(input => {
          if (input.id !== `weight${productId}` && input.id !== `battery${productId}`) {
            input.disabled = false; // K√≠ch ho·∫°t l·∫°i c√°c √¥ nh·∫≠p li·ªáu
          }
        });
        row.querySelector('button').disabled = false; // K√≠ch ho·∫°t l·∫°i n√∫t c·∫≠p nh·∫≠t
      }
    }
  });
}


function blinkProductIdCell(productId) {
  const cell = document.getElementById(`productId${productId}`);
  if (cell) {
    cell.classList.add("blink");

    // Sau 5 gi√¢y th√¨ ng·ª´ng nh√°y
    setTimeout(() => {
      cell.classList.remove("blink");
    }, 5000);
  }
}

// H√†m x√≥a d·∫•u c√°ch ƒë·ªÉ l·∫•y s·ªë nguy√™n
function parseNumber(str) {
    return parseInt(str.replace(/\s/g, ""), 10);
}
window.onload = function () {
    const defaultProducts = ["Milk", "Bread", "Pepsi", "Noodle", "Pork"];
    const defaultPrices = ["20000", "15000", "10000", "4500", "30000"];

    // L∆∞u d·ªØ li·ªáu v√†o localStorage ngay khi trang ƒë∆∞·ª£c load
    ["product1", "product2", "product3", "product4", "product5"].forEach((productId, index) => {
        let priceId = "price" + (index + 1);
        let saleId = "sale" + (index + 1);
        let saleStartTimeId = "saleStartTime" + (index + 1);
        let saleEndTimeId = "saleEndTime" + (index + 1);
        let statusId = "status" + (index + 1);

        // Load d·ªØ li·ªáu t·ª´ localStorage ho·∫∑c s·ª≠ d·ª•ng gi√° tr·ªã m·∫∑c ƒë·ªãnh
        document.getElementById(productId).value = localStorage.getItem(productId) || defaultProducts[index];
        document.getElementById(priceId).value = localStorage.getItem(priceId) || defaultPrices[index];
        document.getElementById(saleId).value = localStorage.getItem(saleId) || "";
        document.getElementById(saleStartTimeId).value = localStorage.getItem(saleStartTimeId) || "";
        document.getElementById(saleEndTimeId).value = localStorage.getItem(saleEndTimeId) || "";
        document.getElementById(statusId).innerText = localStorage.getItem(statusId) || "Ch∆∞a c·∫≠p nh·∫≠t";

        // L·∫Øng nghe s·ª± thay ƒë·ªïi c·ªßa t·ª´ng input ƒë·ªÉ l∆∞u d·ªØ li·ªáu v√†o localStorage
        document.getElementById(productId).addEventListener('input', function () {
            localStorage.setItem(productId, this.value);
        });
        document.getElementById(priceId).addEventListener('input', function () {
            localStorage.setItem(priceId, this.value);
        });
        document.getElementById(saleId).addEventListener('input', function () {
            localStorage.setItem(saleId, this.value);
        });
        document.getElementById(saleStartTimeId).addEventListener('input', function () {
            localStorage.setItem(saleStartTimeId, this.value);
        });
        document.getElementById(saleEndTimeId).addEventListener('input', function () {
            localStorage.setItem(saleEndTimeId, this.value);
        });
    });
};
const timeClickCounts = {};

function toggleTime(element) {
    const id = element.id;

    // Initialize click count for this time input if not already set
    if (!timeClickCounts[id]) {
        timeClickCounts[id] = 0;
    }

    // Increment click count
    timeClickCounts[id]++;

    // On the second click, clear the time input
    if (timeClickCounts[id] % 2 === 0) {
        element.value = "";
        localStorage.setItem(id, "");
    }
}

let sentFlags = {};
function sendPrice(id, productId, address, priceId, saleId, saleStartTimeId, saleEndTimeId, statusId) {
// T√¨m <td> c√≥ id b·∫Øt ƒë·∫ßu l√† "productId" v√† n·ªôi dung l√† id s·∫£n ph·∫©m
  const productIdCells = document.querySelectorAll('[id^="productId"]');
  let productIdCell = null;
  productIdCells.forEach(cell => {
    if (cell.textContent.trim() === id) {
      productIdCell = cell;
    }
  });

  if (!productIdCell) {
    alert(`Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m v·ªõi ID ${id}`);
    return;
  }

  const productRow = productIdCell.parentNode;

  // T√¨m battery div theo ID
  const batteryDiv = productRow.querySelector(`#battery${id}`);
  const batterySegments = batteryDiv ? batteryDiv.querySelectorAll('.battery-segment') : [];

  let isLowBattery = true;
  batterySegments.forEach(segment => {
    if (segment.style.backgroundColor !== "rgb(204, 204, 204)") {
      isLowBattery = false;
    }
  });

  if (isLowBattery) {
    alert(` ü™´ Pin y·∫øu cho s·∫£n ph·∫©m ${id}! Vui l√≤ng s·∫°c pin .`);
   
  }

    const product = document.getElementById(productId).value;
    const price = document.getElementById(priceId).value;
    const sale = document.getElementById(saleId).value; // S·∫Ω l√† '' khi sale k·∫øt th√∫c
    const saleStartTime = document.getElementById(saleStartTimeId).value;
    const saleEndTime = document.getElementById(saleEndTimeId).value;
    const now = new Date();
    const timeString = now.toLocaleString("vi-VN");

    // L∆∞u gi√° g·ªëc n·∫øu ƒë√¢y l√† l·∫ßn c·∫≠p nh·∫≠t ƒë·∫ßu ti√™n ho·∫∑c khi sale b·∫Øt ƒë·∫ßu
    if (!localStorage.getItem(`originalPrice${id}`) || saleStartTime) {
        localStorage.setItem(`originalPrice${id}`, price);
    }

    const data = { id, product, address, price, sale, saleStartTime, saleEndTime, time: timeString };
    ws.send(JSON.stringify(data));

    localStorage.setItem(productId, product);
    localStorage.setItem(priceId, price);
    localStorage.setItem(saleId, sale);
    localStorage.setItem(saleStartTimeId, saleStartTime);
    localStorage.setItem(saleEndTimeId, saleEndTime);
    localStorage.setItem(statusId, `C·∫≠p nh·∫≠t l√∫c: ${timeString}`);

    document.getElementById(statusId).innerText = `C·∫≠p nh·∫≠t l√∫c: ${timeString}`;
    document.getElementById(statusId).style.color = 'blue';
}

function checkSaleTimes() {
    const now = new Date();
    const currentTime = now.toTimeString().slice(0, 5); // L·∫•y gi·ªù:ph√∫t (HH:MM)

    for (let i = 1; i <= 5; i++) {
        const saleStartTime = document.getElementById(`saleStartTime${i}`).value;
        const saleEndTime = document.getElementById(`saleEndTime${i}`).value;
        const productId = `product${i}`;
        const priceId = `price${i}`;
        const saleId = `sale${i}`;
        const saleStartTimeId = `saleStartTime${i}`;
        const saleEndTimeId = `saleEndTime${i}`;
        const statusId = `status${i}`;
        const key = `product${i}`;

        const productData = {
            id: String(i).padStart(2, '0'),
            product: document.getElementById(productId).value,
            address: document.querySelector(`#productTable tr:nth-child(${i}) td:nth-child(3)`).innerText,
        };

        // Khi ƒë·∫øn gi·ªù sale b·∫Øt ƒë·∫ßu
        if (saleStartTime && currentTime === saleStartTime && !sentFlags[key]) {
            sendPrice(
                productData.id,
                productId,
                productData.address,
                priceId,
                saleId,
                saleStartTimeId,
                saleEndTimeId,
                statusId
            );
            sentFlags[key] = true; // ƒê√°nh d·∫•u ƒë√£ g·ª≠i khi sale b·∫Øt ƒë·∫ßu
            console.log(`ƒê√£ g·ª≠i d·ªØ li·ªáu b·∫Øt ƒë·∫ßu sale cho ${productData.product} l√∫c ${currentTime}`);
        }
        // Khi ƒë·∫øn gi·ªù sale k·∫øt th√∫c
        else if (saleEndTime && currentTime === saleEndTime && sentFlags[key]) {
            // ƒê·∫∑t gi√° tr·ªã sale th√†nh chu·ªói r·ªóng tr∆∞·ªõc khi g·ª≠i
            document.getElementById(saleId).value = ""; // X√≥a gi√° tr·ªã √¥ "Gi·∫£m gi√°" tr√™n giao di·ªán
            localStorage.setItem(saleId, ""); // C·∫≠p nh·∫≠t localStorage

            sendPrice(
                productData.id,
                productId,
                productData.address,
                priceId,
                saleId,
                saleStartTimeId,
                saleEndTimeId,
                statusId
            );
            sentFlags[key] = false; // Reset c·ªù sau khi sale k·∫øt th√∫c
            console.log(`ƒê√£ g·ª≠i d·ªØ li·ªáu k·∫øt th√∫c sale cho ${productData.product} l√∫c ${currentTime}`);

            // Kh√¥i ph·ª•c gi√° g·ªëc v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i
            const originalPrice = localStorage.getItem(`originalPrice${i}`) || document.getElementById(priceId).value;
            document.getElementById(priceId).value = originalPrice;
            document.getElementById(statusId).innerText = "ƒê√£ k·∫øt th√∫c sale";
            document.getElementById(statusId).style.color = "red";
        }
        // Reset c·ªù n·∫øu ch∆∞a ƒë·∫øn gi·ªù sale
        else if (saleStartTime && currentTime < saleStartTime) {
            sentFlags[key] = false;
        }
    }
}cdcd
// Ki·ªÉm tra th·ªùi gian m·ªói gi√¢y
setInterval(checkSaleTimes, 1000);

// Ki·ªÉm tra th·ªùi gian m·ªói gi√¢y
setInterval(checkSaleTimes, 1000);

// Ki·ªÉm tra th·ªùi gian m·ªói gi√¢y
setInterval(checkSaleStartTime, 1000); 


    function goBack() {
        window.location.href = "index.html";
    }
    
</script>
<script>
        function updateClock() {
            const now = new Date();
    let hours = now.getHours().toString().padStart(2, '0');
    let minutes = now.getMinutes().toString().padStart(2, '0');
    let seconds = now.getSeconds().toString().padStart(2, '0');
    document.getElementById('time').innerText = `${hours}:${minutes}:${seconds}`;
        }
        setInterval(updateClock, 1000);
        updateClock();
    </script>